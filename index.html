<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <style>
      div.tooltip {
        position: absolute;
        text-align: center;
        width: 100px;
        height: 50px;
        padding: 2px;
        font: 12px sans-serif;
        background: lightsteelblue;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <button id="group1">Multiple Groups</button>
    <button id="group2">One Center</button>
    <svg></svg>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>
      let width = 800,
        height = 800;
      let svg = d3.select("svg").attr("viewBox", "0 0 " + width + " " + height);

      // Load external data
      Promise.all([
        d3.json("links-sample.json"),
        d3.json("cases-sample.json"),
      ]).then((data) => {
        // Data preprocessing
        data[0].forEach((e) => {
          e.source = e.infector;
          e.target = e.infectee;
        });

        console.log(data[0]); //links
        console.log(data[1]); //cases

        var div = d3
          .select("body")
          .append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

        let linkpath = svg
          .append("g")
          .attr("id", "links")
          .selectAll("path")
          .data(data[0])
          .enter()
          .append("path")
          .attr("fill", "none")
          .attr("stroke", "black");

        let node = svg
          .append("g")
          .attr("id", "nodes")
          .selectAll("circle")
          .data(data[1])
          .enter()
          .append("circle")
          .attr("r", 25)
          .style("fill", "steelblue")
          .on("mouseover", (event, d) => {
            let path = d3.select(event.currentTarget);
            path.style("stroke", "red").style("stroke-width", 2);
            //Makes the new div appear on hover:
            div.transition().duration(200).style("opacity", 0.9);
            div
              .html(
                "Age: " +
                  d.age +
                  "</br>" +
                  "Gender: " +
                  d.gender +
                  "</br>" +
                  "Nationality:" +
                  d.nationality
              )
              .style("left", event.pageX + "px")
              .style("top", event.pageY - 28 + "px");
          })
          .on("mouseout", (event, d) => {
            d3.select(".tooltip").text("");
            let path = d3.select(event.currentTarget);
            path.style("stroke", "none");
            //Makes the new div disappear:
            div.transition().duration("50").style("opacity", 0);
          })
          .call(
            d3
              .drag()
              .on("start", dragstarted)
              .on("drag", dragged)
              .on("end", dragended)
          );

        let simulation = d3
          .forceSimulation()
          .nodes(data[1])
          .force(
            "x",
            d3
              .forceX()
              .strength(0.5)
              .x(width / 2)
          )
          .force(
            "y",
            d3
              .forceY()
              .strength(0.2)
              .y(height / 2)
          )
          .force(
            "link",
            d3
              .forceLink(data[0])
              .id((d) => d.id)
              .distance(50)
              .strength(0.5)
          )
          .force("charge", d3.forceManyBody().strength(20))
          .force("collide", d3.forceCollide().strength(1).radius(30))
          .on("tick", (d) => {
            node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);

            linkpath.attr(
              "d",
              (d) =>
                "M" +
                d.source.x +
                "," +
                d.source.y +
                " " +
                d.target.x +
                "," +
                d.target.y
            );
          });

        d3.select("#group1").on("click", function () {
          simulation
            .force(
              "x",
              d3
                .forceX()
                .strength(0.5)
                .x((d) => xPosition(d.class))
            )
            .force(
              "y",
              d3
                .forceY()
                .strength(0.2)
                .y(height / 2)
            )
            .alphaTarget(0.3)
            .restart();
        });

        d3.select("#group2").on("click", function () {
          simulation
            .force("x", d3.forceX().strength(0.1).x(400))
            .force("y", d3.forceY().strength(0.1).y(400))
            .alphaTarget(0.3)
            .restart();
        });

        function dragstarted(event, d) {
          if (!event.active) simulation.alphaTarget(0.3).restart();
          d.fx = d.x;
          d.fy = d.y;
        }

        function dragged(event, d) {
          d.fx = event.x;
          d.fy = event.y;
        }

        function dragended(event, d) {
          if (!event.active) simulation.alphaTarget(0);
          d.fx = null;
          d.fy = null;
        }
      });
    </script>
  </body>
</html>
